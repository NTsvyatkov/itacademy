{% extends "layout.html" %}
{% block body %}
<script>
$(document).ready(function() {
    var tr = [];
    var count_tr=$('#table_size').val();
    var th = ['Id','Product','Description','Dimension','Price','Quantity','Amount'];
    var count_td= th.length-1;
    var page = 1;
    var table_grid = document.getElementById('grid');

  /* Creating table of products (size = count_tr Х count_td)  */

    tr[0] = document.createElement('TR');
    table_grid.appendChild(tr[0]);
    for (var j=0; j<=count_td; j++)
    {
          tr[0].appendChild(document.createElement('TH'));
          tr[0].cells[j].innerHTML=th[j];
    }

  /* Get order id from url*/
  var pathArray = window.location.pathname.split( '/' );
  var order_id = pathArray[2];
   /* End*/

  function create_grid(count_tr, count_td)
    {
        for (var i=1; i<=count_tr;i++ )
        {
            tr[i] = document.createElement('TR');
            table_grid.appendChild(tr[i]);
            tr[i].id=i;
            if (i % 2 == 0) tr[i].style.background = "#c0c0c0"; /* .className = 'tr_style' */
            for (var j=0; j<=count_td; j++)
             {
              tr[i].appendChild(document.createElement('TD'));
             }
        }
      $( "tr:even" ).css( "background-color", "#c0c0c0" );
    }

   create_grid(count_tr,count_td);
  /*End of creating table*/


 function deleting_grid()
  {
    for (var n=table_grid.rows.length ; n>=2; n--)
      {
       table_grid.removeChild(table_grid.childNodes[n]);
      }

  }

  function grid_pagination()
   {
    $.ajax({
        dataType: "json",
        url: '/api/orders/'+order_id,
        type: 'GET',
        success: function(json)
        {
           ajax_success(json);

//           records_amount=(json.records_amount);
//           records_per_page=(json.records_per_page);
//           pages_amount = Math.ceil(records_amount/records_per_page);
//           document.getElementById("page").innerHTML = page;
//           document.getElementById("pages_amount").innerHTML = pages_amount

           if (page==1){
               $('#prev').prop('disabled', true);
               $('#first').prop('disabled', true);
           } else {
               $('#prev').prop('disabled', false);
               $('#first').prop('disabled', false);
           }

           if (page==pages_amount){
               $('#next').prop('disabled', true);
               $('#last').prop('disabled', true);
           } else {
               $('#next').prop('disabled', false);
               $('#last').prop('disabled', false);
           }
         }
      })
     }

 function ajax_success(json)
  {
           deleting_grid();
           create_grid(json.orders.products.length,count_td);

           /*Create table with new products list */
           var k=0;
            for (var product_k in json.orders.products)
                {
                 k++;

                 tr[k].cells[0].innerHTML = json.orders.products[product_k].product_id;
                 tr[k].cells[1].innerHTML = json.orders.products[product_k].product_name;
                 tr[k].cells[2].innerHTML = json.orders.products[product_k].product_description;
                 tr[k].cells[3].innerHTML = json.orders.products[product_k].product_dimension;
                 tr[k].cells[4].innerHTML = json.orders.products[product_k].product_price;
                 tr[k].cells[5].innerHTML = json.orders.products[product_k].product_quantity;
                 tr[k].cells[6].innerHTML = json.orders.products[product_k].product_quantity*json.orders.products[product_k].product_price;

                }
          $('#customer_name').text(json.orders.user_name);
          $('#assignee').text(json.orders.assignee);
          $('#order_number').text(json.orders.order_id);
          $('#status').text(json.orders.order_status);
          $('#total_amount').text("$" + json.orders.total_price);
          $('#delivery_date').text(json.orders.delivery_date);
          $('#quantity_of_items').text(json.orders.quantity_of_items);
          if (!(json.orders.gift)){
              $('#gift').text("No");
          }
          else{
              $('#gift').text("Yes");
          }
          $('#delivery_type').text(json.orders.delivery);
          $('#date_of_ordering').text(json.orders.date);
          $('#delivery_address').text(json.orders.delivery_address);
          $('#preferable_delivery_date').text(json.orders.preferable_delivery_date);
          $('#comments').text(json.orders.comments);
          var session_role = json.orders.session_role;
          /*If customer in session*/
          if (session_role == 'Customer') {
              $('#p_customer_name').css({"display": "None"});
              $('#customer_name').css({"display": "None"});
              $('#p_assignee').css({"display": "None"});
              $('#assignee').css({"display": "None"});

          }

          else if (session_role == 'Superviser' && json.orders.order_status == 'Ordered') {
              $('#p_gift').css({"display": "None"});
              $('#gift').css({"display": "None"});
              $('#p_delivery_date').css({"display": "None"});
              $('#delivery_date').css({"display": "None"});

          }


  }


  if (page==1)
  {
  grid_pagination();
  }

  /*Pagination buttons events*/

   $('#next').click(function(){
    if (page*records_per_page>=records_amount){page=page}
    else {page=page+1}
    grid_pagination()
    });

    $('#prev').click(function(){
    page=page-1;
        if (page<=1){
        page=1;
    }
    grid_pagination()
    });

    $('#first').click(function(){
    page=1;
    grid_pagination()
    });

    $('#last').click(function(){
        page=pages_amount;
        grid_pagination()
    });

  /* Change table size select event*/

    $('#table_size').change(function() {
        page=1;
        count_tr=$('#table_size').val();
        $("#table_size option:selected").each(grid_pagination())
    });

});
</script>

<style>

div.details_block{
 margin:0 15% 0 15%;
 width:70%;
 background-color: #f5f5f5;
}
div.first_details_block {
float:left;
width:25%;}

div.second_details_block {
float:left;
width:25%;
}
div.third_details_block {
float:left;
width:25%;
}

div.fourth_details_block {
float:left;
width:25%;
}

</style>


<div id="order_detail">
    <div id="products_block">
        <div id="amount_of_records" style="margin-left:75%;">
            <lable>Records amount:</lable>
                  <select id="table_size">
                    <option selected>5</option>
                    <option>10</option>

                   </select>
        </div>
        <div id="products">
            <table id='grid' class="grid">
            </table>
        </div>
        <div id="pagination" style="text-align: center">
            <div >
                <input type="button" id="first" value="First">&nbsp
                <input type="button" id="prev" value="Prev">&nbsp
                <input type="button" id="next" value="Next">&nbsp
                <input type="button" id="last" value="Last">
                <div style="font-size:14px; color:#606860;">
                    Page <span id="page"></span> of <span id="pages_amount"></span>
                </div>
            </div>
        </div>
    <div class="details_block">
        <div class="first_details_block">
            <p id="p_customer_name">Customer name: </p>
            <p>Order number: </p>
            <p>Total amount: </p>
            <p>Total number of items: </p>
            <p>Delivery type: </p>
            <p>Delivery address: </p>
            <p>Preferable delivery date: </p>
            <p>Comments: </p>
        </div>
        <div class="second_details_block">
            <p><span id="customer_name"></span></p>
            <p><span id="order_number"></span></p>
            <p><span id="total_amount"></span></p>
            <p><span id="quantity_of_items"></span></p>
            <p><span id="delivery_type"></span></p>
            <p><span id="delivery_address"></span></p>
            <p><span id="preferable_delivery_date"></span></p>
            <p><span id="comments"></span></p>
        </div>
        <div class="third_details_block">
            <p id="p_assignee">Assignee: </p>
            <p>Status:  </p>
            <p id="p_delivery_date">Delivery date: </p>
            <p id="p_gift">Gift: </p>
            <p>Date of ordering: </p>
        </div>
        <div class="fourth_details_block">
            <p><span id="assignee"></span></p>
            <p><span id="status"></span></p>
            <p><span id="delivery_date"></span></p>
            <p><span id="gift"></span></p>
            <p><span id="date_of_ordering"></span></p>
        </div>
    </div>

</div>
</div>

{% endblock body %}