{% extends "layout.html" %}
{% block body %}
   <script type="text/javascript">

   var count_tr=10;
   var tr = [];

   

  $(document).ready(function() {
   var table_grid = document.getElementById('grid');
   function creat_grid(count){
     for (var i=1; i<=count;i++ ){
       tr[i] = document.createElement('TR');
       table_grid.appendChild(tr[i]);
       tr[i].id=i;
       if (i % 2 == 0) tr[i].style.background = "#c0c0c0";
         for (var j=0; j<=3; j++){
           tr[i].appendChild(document.createElement('TD'));}
       }
     }

    creat_grid(count_tr);
  /*End of creating table*/


  function clearing_tr(i){
      for (var j=0; j<=3; j++){
          tr[i].cells[j].innerHTML='';}
  }

  function clearing_grid(){
    for (var n=2 ; n<=count_tr; n++){
      clearing_tr(n);}
  }

  function deleting_grid(){
    for (var n=table_grid.rows.length ; n>=2; n--){
       table_grid.removeChild(table_grid.childNodes[n]);}
  }
  create_entity();

  function create_entity(){
       $.ajax({
        dataType: "json",
        url: '/api/regions',
        type: 'GET',
        //data: json_value,
        contentType: "application/json",
        success: function(json)
        {
            ajax_success(json);
         }
      })
  }

  function delete_id(id)
  {
  if (id=='') id=0;
   $.ajax({
       dataType: "json",
        url: '/api/regions/'+id,
        type: 'DELETE',
        contentType: "application/json",
        success: function(json)
                    {
                        if (json.message == 'success')
                         {
                          alert('The region has been successfully deleted');
                          ajax_success();
                         }
                        else
                         alert (json.message);
                    },

        error: function(e)
                    {
                       error = JSON.parse(e.responseText);
                       alert(error.message);
                    }

  })
 }

  k=0
 function ajax_success(json){
           deleting_grid()
           creat_grid(json.regions.length)

            for (var region_k in json.regions)
                {
                 k++;
        tr[k].cells[0].innerHTML = json.regions[region_k].region_id;
        tr[k].cells[1].innerHTML = json.regions[region_k].name;
        tr[k].cells[2].innerHTML = "<input type='button' value='Edit' id='edit_region'  alt=" + k + ">";
        tr[k].cells[3].innerHTML = "<input type='button' value='Delete' id='delete_region'  alt=" + k + ">";
        tr[k].cells[2].abbr=k;
        tr[k].cells[3].abbr=k;
        tr[k].cells[2].onclick = function edit_region(){
         // gthtyjc
          }
        tr[k].cells[3].onclick= function delete_region(){
          var str = tr[this.abbr].cells[1].innerHTML
          var id_tr = tr[this.abbr].cells[0].innerHTML
          if (confirm('Are you sure you want to delete region '+ str +' '+id_tr+'?')){
            delete_id(id_tr)}
        }
        }
        k=0;

         }





  $('#add_button').click(function(){
  add(name);
    });
  $('#edit_button').click(function(){
  update(name);
    });
  $('#clr').click(deleting_grid);

 function add(name) {
 form_value = {name : $( name = $('#region_name').val())}

   $.ajax({
    data : JSON.stringify({'name' : name}) ,
     dataType: "json",
     url: '/api/regions',
     type: 'POST',
     contentType: "application/json",
     success:function(json){
          creat_grid(json.regions.length);
         create_entity();

         }

         }
      )
  }



 function update(region_id, name) {
  form_value = {name : $( name = $('#region_name').val())}

   $.ajax({ 
     dataType: "json",
     url: '/api/regions',
     type: 'PUT',
     data : JSON.stringify({'region_id': region_id, 'name': name}),
     contentType: "application/json",
     success:function(json){
           creat_grid(json.regions.length);
         create_entity();

         }

         }
      )
  }

  })
   </script>





<div id="region_table">
  <table id='grid' class="grid">
    <tr>
      <th>
        id
      </th>
      <th>
        name
      </th>
      <th>
        edit
      </th>
      <th>
        delete
      </th>
    </tr>
  </table>
</div>


<form action="" id="info">
<fieldset style="width: 300px; height: 100px">
  <legend>Add/Edit Region</legend>
    <div id="name-wrap">
    <label for="region_name">Name</label>
    <input type="text" id="region_name" name="name">
    <p><input type="button" value="Add" id="add_button" /*OnClick="add(name)"*/>  <input type="button" value="Update" id="edit_button"/*OnClick="update(id, name)"*/>  <input type="submit" value="Cancel" OnClick=""></p>
</fieldset>
</form>
    
    
{% endblock body %}